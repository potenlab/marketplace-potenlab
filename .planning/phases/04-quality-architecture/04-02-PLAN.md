---
phase: 04-quality-architecture
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - CLAUDE.md
  - skills/init/SKILL.md
autonomous: true

must_haves:
  truths:
    - "All extensions return standardized summary-format outputs"
    - "MCP servers do not consume more than 40% of context"
    - "Sub-agents use isolated 200K context windows"
    - "Parallel execution uses Task tool with up to 7 concurrent sub-agents"
  artifacts:
    - path: "CLAUDE.md"
      provides: "Output format template and architecture documentation"
      contains: "Output Format"
    - path: "skills/init/SKILL.md"
      provides: "MCP token budget guidelines"
      contains: "Token Budget"
  key_links:
    - from: "CLAUDE.md"
      to: "all /pl:* skills"
      via: "documented output format template"
      pattern: "### .* Complete:"
    - from: "skills/init/SKILL.md"
      to: "MCP configuration"
      via: "ENABLE_TOOL_SEARCH guidelines"
      pattern: "ENABLE_TOOL_SEARCH"
---

<objective>
Document output standards and architecture patterns for the plugin ecosystem.

Purpose: Formalize the standardized output format that all extensions must follow, and document the sub-agent isolation and MCP token budget patterns. This ensures consistency across all /pl:* skills.

Output: Updated CLAUDE.md with output format template and architecture patterns, updated init skill with MCP guidelines.
</objective>

<execution_context>
@/Users/deprasny/.claude/get-shit-done/workflows/execute-plan.md
@/Users/deprasny/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-quality-architecture/04-RESEARCH.md
@skills/init/SKILL.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add output format and architecture docs to CLAUDE.md</name>
  <files>CLAUDE.md</files>
  <action>
Create or update CLAUDE.md with the standardized output format and architecture documentation.

If CLAUDE.md exists, append sections. If not, create it.

Add these sections:

## Extension Output Format

All /pl:* commands must follow this output structure:

```markdown
### [Action] Complete: [Subject]

**Summary:** [2-3 sentence executive summary of what was done]

#### [Primary Data Section]
[Tables, code blocks, or structured data relevant to the action]

#### Key Findings / Changes Made / Results
- [Most important point]
- [Second important point]
- [Third important point]

#### Actionable Items
1. [ ] [Specific next step with file:line if applicable]
2. [ ] [Another action item]

#### Notes
- [Caveats, warnings, or context]
```

## Sub-agent Architecture

### Context Isolation
- Each sub-agent spawned via Task tool gets its own isolated 200K context window
- Sub-agents can read many files without consuming main context
- Only summarized results return to main context
- Sub-agents cannot spawn other sub-agents (no nesting)

### Parallel Execution Limits
- Task tool supports up to 10 concurrent sub-agents
- Recommended: Use 5-7 concurrent sub-agents for reliability
- Claude Code creates tasks and runs first batch in parallel
- Waits for batch to complete before starting next batch

### Sub-agent Instructions
Every sub-agent instruction must include:
- Clear scope (what dimension/task to focus on)
- Output format (summary only, not exploration logs)
- File output location (if applicable)
- Confidence indication (HIGH/MEDIUM/LOW)

## MCP Token Budget

### Guidelines
- MCP tools should not exceed 40% of context window
- Check current usage with `/context` command
- Enable early Tool Search: Set `ENABLE_TOOL_SEARCH=auto:5`

### Best Practices
1. Use CLI tools when available (gh, aws, gcloud, sentry-cli)
2. Prefer project-scoped MCP over user-scoped
3. Disable unused servers via `/mcp` command
4. Set output limits: `MAX_MCP_OUTPUT_TOKENS=25000`

### Warning Signs
- `/context` shows high MCP tool consumption
- Auto-compaction triggers frequently
- Context filling rapidly during MCP-heavy workflows

Reference Pattern 2 (Output Format), Pattern 4 (Sub-agent Isolation), Pattern 5 (Parallel Execution), and Pattern 6 (MCP Budget) from 04-RESEARCH.md.
  </action>
  <verify>CLAUDE.md contains "Extension Output Format", "Sub-agent Architecture", and "MCP Token Budget" sections</verify>
  <done>CLAUDE.md updated with output format template and architecture documentation</done>
</task>

<task type="auto">
  <name>Task 2: Update init skill with MCP guidelines</name>
  <files>skills/init/SKILL.md</files>
  <action>
Enhance the init skill to include MCP token budget guidelines in the initialization process.

Add a new section after Step 3 (Report Results):

### Step 4: Display MCP Guidelines

After initialization, also display the MCP token budget guidelines:

```
MCP Token Budget Guidelines
---------------------------
- MCP tools should not exceed 40% of context
- Check usage with: /context or /pl:context
- Enable early Tool Search: ENABLE_TOOL_SEARCH=auto:5

Recommended MCP Configuration:
1. Use CLI tools (gh, aws, gcloud) when available
2. Prefer project-scoped MCP over user-scoped
3. Disable unused servers: /mcp
4. Set output limits: MAX_MCP_OUTPUT_TOKENS=25000

Check MCP health:
/mcp          # List and manage servers
/context      # See token breakdown
/pl:context   # Potenlab context summary
```

Also update the "Future Enhancements" section to remove items that are now implemented:
- Keep: Interactive setup wizard (future)
- Remove: "Full MCP configuration" - now partially addressed
- Add: "ENABLE_TOOL_SEARCH auto-configuration"

Keep the existing skeleton structure but enhance it with MCP awareness.
  </action>
  <verify>Init skill contains "MCP Token Budget Guidelines" and references /pl:context</verify>
  <done>Init skill updated with MCP token budget guidelines and context management tips</done>
</task>

</tasks>

<verification>
1. `grep -c "Extension Output Format" CLAUDE.md` - Section exists
2. `grep -c "Sub-agent Architecture" CLAUDE.md` - Section exists
3. `grep -c "MCP Token Budget" CLAUDE.md` - Section exists
4. `grep "ENABLE_TOOL_SEARCH" skills/init/SKILL.md` - MCP guidelines added
5. `grep "/pl:context" skills/init/SKILL.md` - References new context command
</verification>

<success_criteria>
- CLAUDE.md contains standardized output format template
- CLAUDE.md documents sub-agent isolation (200K context windows)
- CLAUDE.md documents parallel execution limits (5-7 sub-agents)
- CLAUDE.md documents MCP token budget (40% threshold)
- Init skill includes MCP guidelines in initialization output
</success_criteria>

<output>
After completion, create `.planning/phases/04-quality-architecture/04-02-SUMMARY.md`
</output>
