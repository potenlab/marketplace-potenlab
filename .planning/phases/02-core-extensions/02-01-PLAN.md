---
phase: 02-core-extensions
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - skills/review/SKILL.md
  - skills/refactor/SKILL.md
  - commands/review.md
  - commands/refactor.md
autonomous: true

must_haves:
  truths:
    - "Running /pl:review on a file returns structured feedback with severity levels"
    - "/pl:review cannot modify files (read-only mode enforced)"
    - "Running /pl:refactor modifies code and shows before/after diff"
    - "Refactor workflow includes test verification step"
  artifacts:
    - path: "skills/review/SKILL.md"
      provides: "Read-only code review skill"
      contains: "allowed-tools: Read, Grep, Glob"
    - path: "skills/refactor/SKILL.md"
      provides: "Code refactoring skill with verification"
      contains: "Step 4: Verify"
    - path: "commands/review.md"
      provides: "Slash command registration for /pl:review"
    - path: "commands/refactor.md"
      provides: "Slash command registration for /pl:refactor"
  key_links:
    - from: "commands/review.md"
      to: "skills/review/SKILL.md"
      via: "Claude Code plugin system"
    - from: "commands/refactor.md"
      to: "skills/refactor/SKILL.md"
      via: "Claude Code plugin system"
---

<objective>
Create /pl:review and /pl:refactor skills for code analysis and modification workflows.

Purpose: Enable team to run structured code reviews (read-only) and refactoring (with test verification) through simple slash commands.
Output: Two new skills with corresponding slash commands that follow established patterns from Phase 1.
</objective>

<execution_context>
@/Users/deprasny/.claude/get-shit-done/workflows/execute-plan.md
@/Users/deprasny/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/02-core-extensions/02-RESEARCH.md
@skills/help/SKILL.md
@commands/help.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create review skill and command</name>
  <files>
    skills/review/SKILL.md
    commands/review.md
  </files>
  <action>
Create the review skill at skills/review/SKILL.md with:

**Frontmatter:**
- name: review
- description: Analyze code and return structured feedback with actionable items. Use when asked to review code, check quality, or identify issues.
- allowed-tools: Read, Grep, Glob (CRITICAL: enforces read-only mode)
- argument-hint: file-or-directory

**Content structure:**
1. Target section using $ARGUMENTS, with fallback to ask user
2. Review checklist covering:
   - Code quality (naming, function size, SRP, DRY)
   - Error handling (edge cases, validation)
   - Maintainability (readability, documentation)
   - Performance (obvious issues, data structures)
3. Output format with exact structure:
   - Summary (2-3 sentences)
   - Issues Found table (Severity | Location | Issue | Suggestion)
   - Strengths (bullet points)
   - Actionable Items (numbered checklist)
4. Important notes about read-only mode and severity definitions

Create corresponding command at commands/review.md with:
- description frontmatter matching the skill
- allowed-tools: Read, Grep, Glob
- Brief content explaining this enables /pl:review

Use the code example from 02-RESEARCH.md as the template (lines 189-263).
  </action>
  <verify>
    - File exists: skills/review/SKILL.md
    - File exists: commands/review.md
    - Grep for "allowed-tools: Read, Grep, Glob" in skills/review/SKILL.md returns match
    - Grep for "Severity" in skills/review/SKILL.md returns match (output format)
  </verify>
  <done>
    Review skill enforces read-only mode via allowed-tools and produces structured output with severity levels, locations, and actionable items.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create refactor skill and command</name>
  <files>
    skills/refactor/SKILL.md
    commands/refactor.md
  </files>
  <action>
Create the refactor skill at skills/refactor/SKILL.md with:

**Frontmatter:**
- name: refactor
- description: Refactor code with clear before/after explanation. Verifies changes with tests before completion.
- argument-hint: file refactoring-goal

**Content structure:**
1. Target section using $ARGUMENTS, with fallback to ask user
2. Workflow with 5 explicit steps:
   - Step 1: Analyze (read and understand current code)
   - Step 2: Plan (explain what will change and why, ask confirmation for substantial changes)
   - Step 3: Refactor (make changes, keep focused and minimal)
   - Step 4: Verify (CRITICAL: run tests, fix failures before proceeding)
   - Step 5: Report (before/after code snippets, test results, summary)
3. Output format with:
   - Changes Made section with Before/After code blocks
   - Why explanation for each change
   - Test Results (run/passed/failed counts)
   - Summary of improvements
4. Scope Rules (only modify specified files, ask before expanding)

Create corresponding command at commands/refactor.md with:
- description frontmatter matching the skill
- Brief content explaining this enables /pl:refactor

Use the code example from 02-RESEARCH.md as the template (lines 265-355).

IMPORTANT: Do NOT include allowed-tools restriction - refactor needs Write, Edit, Bash for modifications and testing.
  </action>
  <verify>
    - File exists: skills/refactor/SKILL.md
    - File exists: commands/refactor.md
    - Grep for "Step 4: Verify" in skills/refactor/SKILL.md returns match
    - Grep for "Before:" in skills/refactor/SKILL.md returns match (output format)
    - Grep for "allowed-tools" in skills/refactor/SKILL.md returns NO match (should not be restricted)
  </verify>
  <done>
    Refactor skill includes explicit test verification step and produces before/after diffs with explanations.
  </done>
</task>

</tasks>

<verification>
After both tasks complete:
1. ls skills/ shows: help/, init/, review/, refactor/
2. ls commands/ shows: help.md, init.md, review.md, refactor.md
3. Grep "allowed-tools" skills/review/SKILL.md returns match (read-only enforced)
4. Grep "allowed-tools" skills/refactor/SKILL.md returns nothing (full access)
5. Both skills have structured output format sections
</verification>

<success_criteria>
- skills/review/SKILL.md exists with allowed-tools: Read, Grep, Glob
- skills/refactor/SKILL.md exists with 5-step workflow including test verification
- commands/review.md and commands/refactor.md exist for slash command registration
- Review skill output format includes Severity, Location, Issue, Suggestion columns
- Refactor skill output format includes Before/After code blocks and Test Results
</success_criteria>

<output>
After completion, create `.planning/phases/02-core-extensions/02-01-SUMMARY.md`
</output>
